<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" 
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" 
    crossorigin="anonymous"></script>

    

    <!-- //login-page -->
    <div id="login-page">
        <form class="form-login" id="form-login">
            <div>
                <label for="email">email</label>
                <input type="text" class="input-email" id="input-email">
            </div>
            <div>
                <label for="email">password</label>
                <input type="password" class="input-password" id="input-password">
            </div>
            <button type="submit" class="btn-login">login</button>
        </form>      
    </div>

    <!-- //main-page -->
    <div id="main-page" class="main-page">
        <h1>list todos</h1>
            <div>
                <label for="title">title</label><br>
                <input type="text" class="input-title" id="input-title">
            </div>
            <div>
                <label for="description">description</label><br>
                <input type="text" class="input-description" id="input-description">
            </div>
            <div>
                <label for="status">status</label><br>
                <input type="text" class="input-status" id="input-status">
            </div>
            <div>
                <label for="due_date">due_date</label><br>
                <input type="text" class="input-due_date" id="due_date">
            </div>
            <button type="submit">save</button>
            <div class="list-todos" id="list-todos">
                
            </div>
    </div>
    
    


    <button id="logout-btn">logout</button>


    <script>
        function loginPage(){
            $("#login-page").show();
            $("#main-page").hide();
            $("#logout-btn").hide();
        }
        function mainPage(){
            $("#login-page").hide();
            $("#main-page").show();
            $("#logout-btn").show();
            fetchTodos();
        }
        function login(){
            const email = $("#input-email").val()
            const password = $("#input-password").val()
            $.ajax({
                url: 'http://localhost:3000/login',
                method: 'POST',
                data: {
                    email,
                    password
                }
            })
            .done(response => {
                localStorage.setItem('access_token',response.access_token)
                mainPage()
            })
            .fail((xhr,textstatus) => {
                console.log(xhr,textstatus)
            })
            .always(_ => {
                $("#input-email").val("")
                $("#input-password").val("")
            })
        }
        function logout(){
            localStorage.clear()
            loginPage()
        }
        function fetchTodos(){
            $.ajax({
                url: "http://localhost:3000/todos",
                method: "GET",
                headers: {
                    access_token: localStorage.getItem('access_token')
                }
            })
            .done(response => {
                console.log(response)
                for(let i  = 0; i < response.length; i++){
                    $("#list-todos").append(` <div class="todos" id="todos">
                    <h3>${i + 1}. ${response[i].title}</h3>
                    <p>${response[i].description}</p>
                    <p>${response[i].status}</p>
                    <p>${response[i].due_date}</p>
                    </div>`)
                }
            })
            .fail(error => {
                console.log(error)
            })
        }

        $(document).ready(function(){
            if(localStorage.getItem('access_token')){
                mainPage()
            } else {
                loginPage()
            }

            $("#form-login").on("submit", function(e){
                e.preventDefault();
                login()
            });

            $("#logout-btn").on("click", function(){
                logout()
            });



        });
    </script>   
    
</body>
</html>